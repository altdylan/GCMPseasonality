#install wget

sudo apt install wget

#make folders

cd ~
mkdir Seasonality
cd Seasonality
mkdir RawInput
mkdir Input
mkdir Output

#get data

wget \
-O "RawInput/all.biom" \
"https://www.dropbox.com/s/mwyfj2lu5bv1mrv/all.biom?dl=0"

wget \
-O "Input/GCMP_EMP_map_r28_lizardisland_genus.txt" \
"https://www.dropbox.com/s/hmn2s439vxd01e4/GCMP_EMP_map_r28_lizardisland_genus.txt?dl=0"

#this will convert the .biom file to a feature table usable in qiime2
#we can then filter the feature table by the metadata file we choose to use

qiime tools import \
--input-path RawInput/all.biom \
--type 'FeatureTable[Frequency]' \
--input-format BIOMV210Format \
--output-path Input/GCMP_feature_table.qza

#excludes data from feature table based on samples in metadata
#creates new feature table and visualization

qiime feature-table filter-samples \
--i-table Input/GCMP_feature_table.qza \
--m-metadata-file Input/GCMP_EMP_map_r28_lizardisland_genus.txt \
--o-filtered-table Input/GCMP_LI_feature_table.qza \

qiime feature-table summarize \
--i-table Input/GCMP_LI_feature_table.qza \
--m-sample-metadata-file Input/GCMP_EMP_map_r28_lizardisland_genus.txt \
--output-dir Output/LI_feature_table.qzv \

#this will split the Lizard Island feature table into summer and winter tables

#dl metadata containing only winter samples

wget \
-O "Input/GCMP_EMP_map_r28_lizardisland_genus_WINTER.tsv" \
"https://www.dropbox.com/s/ya0cgglx3leedxv/GCMP_EMP_map_r28_lizardisland_genus_WINTER.tsv?dl=0"

#create winter feature table

qiime feature-table filter-samples \
--i-table Input/GCMP_LI_feature_table.qza \
--m-metadata-file Input/GCMP_EMP_map_r28_lizardisland_genus_WINTER.tsv \
--o-filtered-table Input/GCMP_LI_WINTER_feature_table.qza

#create summer feature table

qiime feature-table filter-samples \
--i-table Input/GCMP_LI_feature_table.qza \
--m-metadata-file Input/GCMP_EMP_map_r28_lizardisland_genus_WINTER.tsv \
--p-exclude-ids \
--o-filtered-table Input/GCMP_LI_SUMMER_feature_table.qza
#create rooted phylgenetic artifact
#
#get .tre file
#
wget \
-O "RawInput/gg_constrained_deblur_fastttree.tre" \
"https://www.dropbox.com/s/4s8rxwzlcqh0dfx/gg_constrained_deblur_fastttree.tre?dl=0" \

#import tre
qiime tools import \
--input-path RawInput/gg_constrained_deblur_fastttree.tre \
--output-path Input/GCMP-tree.qza \
--type 'Phylogeny[Rooted]'

